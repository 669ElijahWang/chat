# 项目模块功能与设计文档编制计划

## 文档目标
- 系统性呈现前后端各模块的功能、职责与依赖关系。
- 说明整体架构设计、数据模型、接口与部署形态，便于研发与运维协作。

## 交付物
- 一份可维护的项目说明文档（建议：`docs/系统设计与模块说明.md`）。
- 附带关键文件路径引用与必要的结构图（ASCII/示意图）。

## 文档结构（拟定）
1. 概览与架构图
   - 技术栈、运行时拓扑（前端 ←→ 后端 ←→ 数据/缓存/消息队列）。
2. 模块说明
   - `chatfrontend`（Vue 3 + Vite + Element Plus）
   - `chatbackend`（Spring Boot 3，AI 聊天与向量检索）
   - `wangbackend`（Spring Boot 3，含媒体与页面生成扩展）
3. 关键功能与流程
   - 认证登录（JWT、刷新）、聊天与流式响应（SSE/WebSocket）、RAG/知识库、工具调用、图像分割、页面生成（wangbackend）。
4. API 设计总览
   - 按控制器归档路由与方法（示例：`/auth/**`、`/chat/**`、`/vector/**`、`/generate/**`）。
5. 数据模型
   - 核心实体（User、Conversation、Message、KnowledgeBase、VectorDocument、Tool、Agent）与字段要点。
6. 配置与安全
   - `application.yml` 要点、CORS、鉴权放行规则、第三方模型/服务配置项。
7. 部署与运维
   - Docker 镜像与 Nginx、健康检查、环境变量约定；（如后续存在 Compose/CI 再补充）。
8. 前端结构与交互
   - 路由、状态、API 封装、构建配置与反向代理。
9. 维护建议
   - 模块依赖更新、配置项变更清单、测试与监控建议。

## 信息来源（已梳理）
- 前端：
  - 入口与挂载：`chatfrontend/src/main.js`、`chatfrontend/src/App.vue`、`chatfrontend/index.html`
  - 路由与状态：`chatfrontend/src/router/index.js`、`chatfrontend/src/stores/auth.js`
  - API 封装：`chatfrontend/src/api/request.js` 及业务 API 文件
  - 构建与部署：`chatfrontend/package.json`、`chatfrontend/vite.config.js`、`chatfrontend/Dockerfile`、`chatfrontend/nginx.conf`
- 后端（两个模块基本同构）：
  - 入口：`*/src/main/java/com/aichat/AiChatApplication.java`
  - 控制器：`*/src/main/java/com/aichat/controller/*.java`（Auth/Chat/Stream/Vector/Agent/Health/SseTest/Segmentation 等）
  - 服务：`*/src/main/java/com/aichat/service/**`（DeepSeek、Embedding、Ingestion、Conversation/History、Tool、Segmentation、Generate/Media/Storage 等）
  - 实体与仓库：`*/src/main/java/com/aichat/domain/entity/*.java`、`*/repository/*.java`
  - 配置与安全：`*/src/main/resources/application.yml`、`*/security/SecurityConfig.java`
  - Docker：`chatbackend/Dockerfile`、`wangbackend/Dockerfile`

## 实施步骤
1. 按上述结构整理详细条目与文字说明，补充必要图示。
2. 提取关键 API（控制器路由与方法签名）形成一览表。
3. 汇总数据模型与字段要点，标注与业务流程的关联。
4. 梳理配置与安全策略，列出可变更项与默认值来源。
5. 整理部署流程（镜像、Nginx、健康检查、环境变量），给出运行时拓扑。
6. 形成首版文档并进行交叉校对（代码引用与路径核对）。

## 输出位置与格式
- 新增文件：`docs/系统设计与模块说明.md`（UTF-8，Markdown）。
- 文档内保留文件路径引用，便于 IDE 跳转。

## 初步梳理概览（简版）
- 模块：
  - `chatfrontend`：SPA，路由与状态、Axios API 封装、Nginx 反代 `/api` 与 `/ws`，支持 SSE。
  - `chatbackend`：认证/聊天/向量检索/工具/图像分割，配置集中于 `application.yml`。
  - `wangbackend`：在上述基础上扩展媒体抓取与页面生成。
- 技术栈：Spring Boot 3（Web/WebSocket/Security/JPA/Redis/Elasticsearch/RabbitMQ）、PostgreSQL+`pgvector`、JWT、WebClient；前端 Vue 3/Vite/Pinia/Element Plus/Axios。
- 部署：多阶段 Docker；后端健康检查 `GET /health`；前端 Nginx 静态托管与反代。

## 校验与后续
- 交付前进行路由/方法/实体名的最终核对。
- 后续如新增 Compose 或 CI，将补充到文档部署章节。