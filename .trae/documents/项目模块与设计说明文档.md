# 文档目标与范围
- 面向本仓库，仅覆盖 `chatfrontend` 与 `chatbackend` 两个模块
- 清晰展示：模块功能、分层设计、关键文件、主要 API、数据模型、鉴权与流式设计、部署与配置

## 总览架构
- 前端：Vue3 + Vite + Pinia + Element Plus，统一通过 `axios` 封装调用后端，SSE 解析实现流式渲染
- 后端：Spring Boot 3 分层（Controller/Service/Repository/Domain），JWT 无状态鉴权，提供 REST 与 SSE
- 交互：前端 `BaseURL=/api`；后端 `server.servlet.context-path=/api`（`chatbackend/src/main/resources/application.yml:83-91`）
- 鉴权：登录/注册等放行，其他接口需 `Bearer` Token（`chatbackend/src/main/java/com/aichat/security/SecurityConfig.java:65-75`）

## chatfrontend 模块
- 技术栈与入口：`chatfrontend/package.json:12-25`，`chatfrontend/src/main.js:1-21`
- 路由与页面：`chatfrontend/src/router/index.js:4-58`（登录/注册/聊天/知识库/Agents/分割/个人中心）
- 状态管理：`Pinia`，认证存储于 `stores/auth`（文档中简述用法）
- API 封装：`chatfrontend/src/api/request.js:6-95`（请求/响应拦截、401 刷新/重登）
- 业务 API：
  - 认证：`chatfrontend/src/api/auth.js:3-35`
  - 聊天：`chatfrontend/src/api/chat.js:3-300`（普通消息与 SSE 流式、文件流式）
  - 知识库：`chatfrontend/src/api/knowledge.js:3-86`
  - Agents：`chatfrontend/src/api/agent.js:3-33`
  - 用户：`chatfrontend/src/api/user.js:3-13`
  - 分割：`chatfrontend/src/api/segmentation.js:3-9`
- Nginx 代理：`chatfrontend/nginx.conf:31-75`（`/api/` 与 `/ws/` 反向代理、SSE 友好配置）

## chatbackend 模块
- 技术栈与依赖：`chatbackend/pom.xml:28-205`（Web/WebSocket/Security/JPA/Redis/Elasticsearch/AMQP/JWT/WebFlux/文件处理等）
- 入口：`AiChatApplication.java`（文档中标注路径与启动说明）
- 全局配置：`chatbackend/src/main/resources/application.yml:1-191`（数据库、Redis、Elasticsearch、RabbitMQ、JWT、CORS、向量检索、日志；文档中仅列出键，不展示敏感值）
- 鉴权与 CORS：`chatbackend/src/main/java/com/aichat/security/SecurityConfig.java:57-95`（JWT 过滤器、放行路径、跨域源）
- 控制器与主要 API：
  - 健康：`HealthController`（`GET /health`，`chatbackend/src/main/java/com/aichat/controller/HealthController.java:12`）
  - 认证：`AuthController`（注册/登录/刷新/登出/当前用户，`chatbackend/.../AuthController.java:18-49`）+ `CaptchaController`（`GET /auth/captcha`，`chatbackend/.../CaptchaController.java:25,35`）
  - 用户：`UserController`（更新资料/修改密码，`chatbackend/.../UserController.java:20,30,74`）
  - 聊天：`ChatController`（会话/消息 CRUD，`chatbackend/.../ChatController.java:24-102`）
  - 流式聊天：`ChatStreamController`（SSE：`POST /chat/stream` 与文件流式，`chatbackend/.../ChatStreamController.java:33,75,250`）
  - 知识库：`VectorController`（库/文档管理与检索，`chatbackend/.../VectorController.java:26-277,142`）
  - Agents：`AgentController`（Agent CRUD/工具列表，`chatbackend/.../AgentController.java:25,67,78,101,112,121`）
  - 测试：`SseTestController`（SSE 演示，`chatbackend/.../SseTestController.java:16,24`）
  - 分割：`SegmentationController`（`POST /polyp/segment`，`chatbackend/.../SegmentationController.java:16,22`）
- 服务设计（文档将按职责说明）：
  - LLM 调用：DeepSeekService（WebClient、模型与超时重试）
  - 嵌入/RAG：EmbeddingService、VectorService，文件/URL/文本摄取与分段
  - 会话与历史：ChatService/ConversationService/ChatHistoryService
  - 认证与用户：AuthService/CustomUserDetailsService
  - 工具调用：ToolService/ToolExecutor（Calculator、KnowledgeSearch 等）
  - 分割服务：CaraNetSegmentationService（Python 依赖，Docker 中准备）
- 数据模型与仓库（文档列出实体字段要点）：User/Conversation/Message/KnowledgeBase/VectorDocument/Agent；对应 Repository 接口

## 交互与时序
- 聊天流程：创建会话 → 发送消息（普通/SSE）→ 流式解析（`final`/`[DONE]`/错误事件）→ 持久化历史
- 知识库流程：创建库 → 文档摄取（文件/URL/文本/预览）→ RAG 检索 → 应答拼接
- Agent 配置：模型/温度/最大 tokens、工具集合、知识库绑定 → 前端调用与后端执行

## 运行与部署
- 端口与上下文：后端 `8080` + `/api`；前端 `vite dev` 默认 `5173`
- Docker 要点：前端多阶段构建 + Nginx；后端 Maven → JRE + Python 组件准备；健康检查 `GET /health`
- 环境配置建议：敏感值转环境变量/密钥管理；生产 CORS 与代理地址按部署环境调整

## 交付形式
- 生成一份 Markdown 文档（中文），包含上述章节与关键文件引用（`file_path:line_number`）
- 可选：在仓库新增 `docs/architecture.md` 或直接以消息回复文档内容；由你确认后执行
